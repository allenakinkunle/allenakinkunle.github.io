---
layout: post
title: Deriving Machine Learning Cost Functions using Maximum Likelihood Estimation (MLE) - Part I
comments: true
tags: ['Machine-Learning']
image_url: mathematics.jpg
excerpt: 'Mean Squared Error (MSE) - a commonly used cost function for regression problems derived using Maximum Likelihood Estimation (MLE)'
---

### Motivation
In supervised machine learning, cost functions are used to measure a trained model's performance. The most commonly used cost function for regression is the Mean Squared Error (MSE), and Cross Entropy for binary classification problems. For many people, the reasons for choosing these cost functions are not at all clear.  
The purpose of this two-part article is to shed some light on the choice of these cost functions by deriving them using Maximum Likelihood Estimation (MLE). Part I will focus on deriving MSE while [Part II](/deriving-ml-cost-functions-part2){:target="_blank"} will focus on deriving Cross Entropy.

### Background
Given a training set of $n$ examples $(x^{(1)}, y^{(1)}), (x^{(2)}, y^{(2)}), \cdots (x^{(n)}, y^{(n)})$ where $x^{(i)}$ is the feature vector for the $i^{th}$ training example and $y^{(i)}$ is its target, the goal of supervised learning is to learn a model $f: \mathcal{X} \to \mathcal{Y}$, a mapping that given $x \in \mathcal{X}$ outputs a prediction $\hat y \in \mathcal{Y}$. $\mathcal X$ and $\mathcal Y$ are called the input space and output space respectively.  

In order to measure how well the model fits our training data, we define a loss function. For training example $(x^{(i)}, y^{(i)})$, the loss $\mathcal{L(y^{(i)}, \hat y^{(i)})}$ measures how different the model's prediction $\hat y^{(i)}$ is from the true label or value.
The loss is calculated for all training examples, and its average taken. This value is called the cost function and is given by:

<p class="math">
$$
\begin{align}
  Cost = \frac{1}{n}\sum_{i=1}^n\mathcal{L} \bigg( y^{(i)}, \hat y^{(i)} \bigg)
\end{align}
$$
</p>

The model $f$ usually has some unknown parameter $\theta$ (In general, $\theta$ is a vector of parameters) which we will try to estimate using the training set. We can frame supervised learning as an optimisation problem - that is, we estimate the value of $\theta$ by picking the value that minimises the cost function we chose for our problem. Let us call this parameter estimate $\hat \theta$.

<p class="math">
$$
\begin{align}
  \hat \theta = \underset{\theta}{\operatorname{arg\,min}} \frac{1}{n}\sum_{i=1}^n\mathcal{L}\bigg(y^{(i)}, \hat y^{(i)}\bigg)
\end{align}
$$
</p>

### What is Maximum Likelihood Estimation?
Maximum Likelihood Estimation (MLE) is a method of estimating the unknown parameter $\theta$ of a model, given observed data. It estimates the model parameter by finding the parameter value that maximises the likelihood function. The parameter estimate is called the maximum likelihood estimate $\hat{\theta}_{MLE}$.  

#### Likelihood Function
Given a set of independent and identically distributed (i.i.d)[^iid] random variables $X_1, X_2, \cdots, X_n$ from a probability distribution $P_\theta$ with parameter $\theta$. We assume the random variables have a joint probability density function (or joint probability mass function in the case of discrete variables)[^jpdf] $f(x_1, x_2,\cdots, x_n|\theta)$. Suppose $x_1, x_2,\cdots, x_n$ are the observed values of the random variables, we define the likelihood function, a function of parameter $\theta$ as:   

<p class="math">
$$
\begin{align}
  \mathcal{L}(\theta | x_1, x_2, \cdots, x_n) = f(x_1, x_2, \cdots, x_n|\theta) \label{eq:likelihood}
\end{align}
$$
</p>

The likelihood function measures how plausible it is that the observed data was generated by the model with a particular value of $\theta$.
For example, if we use $\theta_1$ and $\theta_2$ as values of $\theta$ and find that $\mathcal{L(\theta_1 | x_1, \cdots, x_n)}$ > $\mathcal{L(\theta_2 | x_1, \cdots, x_n)}$, we can reasonably conclude that the observed data is more likely to have been generated by the model with its parameter being $\theta_1$.

Remember that we assumed that the observed data $x_1, x_2,\cdots, x_n$ were drawn i.i.d from the probability distribution. Also recall that for independent random variables $X_1$ and $X_2$, $f(x_1,x_2\|\theta) = f(x_1\|\theta) \cdot f(x_2\|\theta)$. Considering these, our likelihood function in equation $\eqref{eq:likelihood}$ becomes:

<p class="math">
$$
\begin{eqnarray}
  \mathcal{L(\theta | x_1, x_2, \cdots, x_n)} & = & f(x_1|\theta)\cdot f(x_2|\theta)\cdots\cdot f(x_n|\theta) \nonumber \\
                                          & = & \prod_{i=1}^n f(x_i|\theta) \label{eq:likelihood-product}
\end{eqnarray}
$$
</p>

<p>where $f(x_i|\theta)$ is the probability density (or mass for discrete variables) function of the random variable $X_i$. Since all the random variables are drawn from the same distribution, their probability density (or mass) function will be the same.</p>

It is often easier to work with the natural logarithm of the likelihood function, called the log-likelihood. Recalling the product rule of logarithms, $log(a \cdot b) = log(a) + log(b)$. If we apply the product rule to equation \eqref{eq:likelihood-product} by taking its natural logarithm, it becomes:

<p class="math">
$$
\begin{eqnarray}
  \log \bigg(\mathcal{L(\theta | x_1, x_2, \cdots, x_n)}\bigg) & = & \log \bigg( f(x_1|\theta)\cdot f(x_2|\theta)\cdots\cdot f(x_n|\theta) \bigg) \nonumber \\
                                                              & = & \log(f(x_1|\theta)) + \log(f(x_2|\theta)) + \cdots + \log (f(x_n|\theta)) \nonumber \\
                                                              & = & \sum_{i=1}^n \log \bigg(f(x_i|\theta) \bigg) \label{eqn:log-likelihood}
\end{eqnarray}
$$
</p>

To find the value of $\theta$ that maximises the likelihood function, we find its critical point, the point at which the function's derivative is $0$. That is:

<p class="math">
$$
\begin{align}
  \frac{\partial \mathcal{L(\theta)}}{\partial \theta} = 0
\end{align}
$$
</p>

In most cases, this derivative is easier to compute for the log-likelihood function in equation $\eqref{eqn:log-likelihood}$ than for the vanilla likelihood function in equation $\eqref{eq:likelihood-product}$. Since logarithm is a monotononically increasing function, that is, if $x_1 > x_2$, then $\log(x_1) > log(x_2)$, the value that maximises the likelihood is also the value that maximises the log-likelihood function.   
The other advantage of using log-likehood over likelihood is that it avoids numerical precision issues. Likelihoods are very small numbers, and taking the product of small numbers creates even smaller numbers, which can cause [arithmetic underflow](https://en.wikipedia.org/wiki/Arithmetic_underflow){:target="_blank"}.  

In other words, 

<p class="math">
$$
\begin{align}
  \hat{\theta}_{MLE} =  \underset{\theta}{\operatorname{arg\,max}}\ \mathcal L(\theta\,| x_1, \cdots, x_n)  = \underset{\theta}{\operatorname{arg\,max}}\ \log (\mathcal L(\theta\,| x_1, \cdots, x_n))
\end{align}
$$
</p>

### Deriving Mean Squared Error(MSE) using MLE
Mean Squared Error is the cost function commonly used for regression. Given a set of $n$ traning examples of the form $(x^{(i)}, y^{(i)})$, MSE is given by:
<p class="math">
$$
\begin{align}
  MSE = \frac{1}{n} \sum_{i=1}^n\bigg(y^{(i)} - \hat y^{(i)}\bigg)^2 \label{eqn:mean-s}
\end{align} 
$$
</p>

where $x^{(i)}$ is the feature vector, $y^{(i)}$ is the true output value, and $\hat y^{(i)}$ is the regression model's prediction for the $i^{th}$ training example.


In this section, we will derive MSE using maximum likelihood estimation.

#### Regression Model
Given a vector of predictor variables $X = (X_1, X_2, \cdots X_p)$, and quantitative outcome variable $Y$, linear regression assumes that there is a linear relationship between the population mean of the outcome and the predictor variables. This relationship can be expressed by:

<p class="math">
$$
\begin{align}
  \mathbb{E}(Y|X) = \beta_0 + \beta_1 X_1 + \cdots + \beta_p X_p \label{eqn:true-regression}
\end{align}
$$
</p>

<p>$\mathbb{E}(Y|X)$ measures the population mean of $Y$ given a particular value of $X$ and it is often called the true regression line. Now, our observed data will not lie exactly on this true regression line. They will be spread about the true regression line. For example, if we are trying to predict height from age of a population, we will find that people of the same age will have different heights. Each person's height will differ from the population mean $\mathbb{E}(Y|X)$ by a certain amount. We represent this mathematically as:</p>

<p class="math">
$$
\begin{eqnarray}
  Y & = & \mathbb{E}(Y|X) + \epsilon \nonumber \\
    & = & \beta_0 + \beta_1 X_1 + \cdots + \beta_p X_p + \epsilon \label{eqn:regression}
\end{eqnarray}
$$
</p>

The spread about the true regression line is what the $\epsilon$ term captures. We assume it is independent of $X$ and is drawn from a Normal distribution with zero mean ($\mu$ = 0) and variance $\sigma^2$, i.e. $\epsilon \sim \mathcal{N}(0, \sigma^2)$.  

#### Estimating linear regression's model parameters
The true regression line and its model parameters $\beta_0, \beta_1, \cdots \beta_p$ in equation \eqref{eqn:regression} are unknown, so we will try to estimate them using training data $(x^{(1)}, y^{(1)}), (x^{(2)}, y^{(2)}), \cdots (x^{(n)}, y^{(n)})$, where $x^{(i)}$ is a vector of $p$ predictor variables $(x_1, x_2, \cdots, x_p)$ and $y^{(i)}$ is the target value. Our model (the estimate of the true regression line) is:

<p class="math">
$$
\begin{eqnarray}
  y^{(i)} & = & \beta_0 + \beta_1 x^{(i)}_1 + \cdots + \beta_p x^{(i)}_p + \epsilon \nonumber \\
               & = & \beta^\intercal x^{(i)} + \epsilon \nonumber \\
               & = & \hat y^{(i)} + \epsilon \label{eqn:estimate-reg}
\end{eqnarray}
$$
</p>

<p>You will notice that $\hat y^{(i)}$ in equation \eqref{eqn:estimate-reg} is the estimate of $\mathbb{E}(Y|X)$ in equation \eqref{eqn:regression}. The $\epsilon$ term is called the residual and it measures the difference between the observed value $y^{(i)}$ and the predicted value $\hat y^{(i)}$ from the regression equation.</p>

Estimating $\beta_0, \beta_1, \cdots \beta_p$ using the training data is an optimisation problem that we can solve using MLE by defining a likelihood function. Since $\epsilon$ is normally distributed $\epsilon \sim \mathcal{N}(0, \sigma^2)$, our outcome variable $y$ will also be normally distributed. So, $y \sim \mathcal{N}(\beta^\intercal x, \sigma^2)$  The probability density function of the normal distribution (parameterised by $\mu$: mean, and $\sigma^2$: variance) is given by:
<p class="math">
$$
\begin{align}
  f(y \mid \color{red}\mu, \color{black}\sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2} } e^{ -\frac{(y-\color{red}\mu\color{black})^2}{2\sigma^2} } \label{eqn:pdf}
\end{align}
$$
</p>

Therefore, if we replace the parameter $\mu$ with the mean of $y$, we get: 

<p class="math">
$$
\begin{align}
  f(y \mid \color{red}\beta^\intercal x \color{black}, \sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2} } e^{ -\frac{(y-\color{red}\beta^\intercal x\color{black})^2}{2\sigma^2} } 
\end{align}
$$
</p>

The log-likelihood function will then be:

<p class="math">
$$
\begin{eqnarray}
  \log \bigg(\mathcal{L(\beta | x^{(1)}, x^{(2)}, \cdots, x^{(n)})}\bigg) & = & \sum_{i=1}^n \log \bigg( \frac{1}{\sqrt{2\pi\sigma^2} } e^{ -\frac{(y-\beta^\intercal x^{(i)})^2}{2\sigma^2} }  \bigg) \nonumber \\
                                                              & = & n \log \bigg( \frac{1}{\sqrt{2\pi\sigma^2} } \bigg) - \sum_{i=1}^n \frac{(y-\beta^\intercal x^{(i)})^2}{2\sigma^2}
\end{eqnarray}
$$
</p>

Since we need to take the derivative of log-likehood function with respect to $\beta$ to find the maximum likehood estimate of $\beta$, we can remove all the terms that do not contain our parameter $\beta$ as they do not have any effect on our optimisation [^remove-terms], so our equation becomes:

<p class="math">
$$
\begin{eqnarray}
  \log \bigg(\mathcal{L(\beta | x^{(1)}, x^{(2)}, \cdots, x^{(n)})}\bigg) & = & - \sum_{i=1}^n (y-\beta^\intercal x^{(i)})^2 \nonumber \\
                                                              & = & - \sum_{i=1}^n (y-\hat y^{(i)})^2 \label{eqn:mse}
\end{eqnarray}
$$
</p>

The value of $\beta$ that maximises equation \eqref{eqn:mse} is the maximum likelihood estimate $\hat \beta_{MSE}$. That is,

<p class="math">
$$
\begin{align}
  \hat \beta_{MSE} = \underset{\beta}{\operatorname{arg\,max}} \bigg[ -\sum_{i=1}^n(y-\hat y^{(i)})^2 \bigg] \label{eqn:maxfunc}
\end{align}
$$
</p>

Recall that maximising a function is the same as minimising its negative, so we can rewrite equation \eqref{eqn:maxfunc} as

<p class="math">
$$
\begin{eqnarray}
  \hat \beta_{MSE} & = & \underset{\beta}{\operatorname{arg\,max}} \bigg[ -\sum_{i=1}^n(y-\hat y^{(i)})^2 \bigg] \nonumber \\
                   & = & \underset{\beta}{\operatorname{arg\,min}} \color{red}\sum_{i=1}^n(y-\hat y^{(i)})^2 \label{eqn:minfunc}
\end{eqnarray}
$$
</p>

Taking the average across all $n$ training examples, we get:

<p class="math">
$$
\begin{align}
  \hat \beta_{MSE} = \underset{\beta}{\operatorname{arg\,min}} \color{red} \frac{1}{n} \sum_{i=1}^n(y-\hat y^{(i)})^2
\end{align}
$$
</p>

which is exactly the mean squared error (MSE) cost function as defined in equation \eqref{eqn:mean-s}. 

### Conclusion
This article introduced the concept of maximum likehood estimation, likehood function, and showed the derivation of mean squared error (MSE). The second part will cover the derivation of cross entropy using maximum likelihood estimation.

### Footnotes
[^iid]: A set of random variables $X_1, X_2, \cdots, X_n$ are said to be independent and identically distributed if they have the same probability distribution and are mutually independent. [Wikipedia Article](https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables){:target="_blank"}

[^jpdf]: This [note](https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading7a.pdf){:target="_blank"} from the [Introduction to Probability and Statistics](https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/){:target="_blank"} class on MIT OpenCourseWare explains joint probability mass and density functions clearly.

[^remove-terms]: The terms without the parameter $\beta$ are regarded as constants in the log-likelihood function, and differentiating a constant gives us zero.

